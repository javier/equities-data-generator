{
  "__inputs": [
    {
      "name": "DS_QDB",
      "label": "qdb",
      "description": "",
      "type": "datasource",
      "pluginId": "questdb-questdb-datasource",
      "pluginName": "QuestDB"
    }
  ],
  "__elements": {},
  "__requires": [
    {
      "type": "panel",
      "id": "ae3e-plotly-panel",
      "name": "Plotly panel",
      "version": "0.5.0"
    },
    {
      "type": "panel",
      "id": "candlestick",
      "name": "Candlestick",
      "version": ""
    },
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "11.6.0"
    },
    {
      "type": "datasource",
      "id": "questdb-questdb-datasource",
      "name": "QuestDB",
      "version": "0.1.6"
    },
    {
      "type": "panel",
      "id": "table",
      "name": "Table",
      "version": ""
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "Equities Orderbook Realtime Demo with Arrays",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "description": "Visualizes the per-venue L2 order book for the selected equity symbol. Uses the latest snapshot from equities_market_data (venue fixed to NASDAQ for a clean single-book view).",
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "hideTimeOverride": true,
      "id": 27,
      "maxPerRow": 2,
      "options": {
        "onclick": "console.log(data)\nwindow.updateVariables({query:{'var-project':'test'}, partial: true})",
        "script": "function parseArray(val) {\n  if (Array.isArray(val)) return val;\n  if (typeof val === \"string\") {\n    return val.replace(/[{}]/g, \"\")\n      .split(\",\")\n      .filter(x => x.length > 0)\n      .map(Number);\n  }\n  return [];\n}\n\nconst NUM_SEGMENTS = 4; // Number of wall segments per side (tweak as you like)\nconst table = data.series[0];\nconst fields = table.fields;\n\nconst bprices = fields.find(f => f.name === \"bprices\");\nconst bcumvolumes = fields.find(f => f.name === \"bcumvolumes\");\nconst bvolumes = fields.find(f => f.name === \"bvolumes\");\nconst aprices = fields.find(f => f.name === \"aprices\");\nconst acumvolumes = fields.find(f => f.name === \"acumvolumes\");\nconst avolumes = fields.find(f => f.name === \"avolumes\");\n\nif (!bprices || !bcumvolumes || !aprices || !acumvolumes) {\n  throw new Error(\"Missing required array fields\");\n}\n\nconst bps = parseArray(bprices.values.get(0));\nconst bvs = parseArray(bcumvolumes.values.get(0));\nconst brs = bvolumes ? parseArray(bvolumes.values.get(0)) : [];\nconst aps = parseArray(aprices.values.get(0));\nconst avs = parseArray(acumvolumes.values.get(0));\nconst ars = avolumes ? parseArray(avolumes.values.get(0)) : [];\n\nconst bids = [];\nfor (let i = 0; i < Math.min(bps.length, bvs.length); i++) {\n  bids.push({ x: bps[i], y: bvs[i], raw: brs[i] ?? null });\n}\n\nconst asks = [];\nfor (let i = 0; i < Math.min(aps.length, avs.length); i++) {\n  asks.push({ x: aps[i], y: avs[i], raw: ars[i] ?? null });\n}\n\nbids.sort((a, b) => b.x - a.x);\nasks.sort((a, b) => a.x - b.x);\n\nconst bestBid = bids[0]?.x ?? 0;\nconst bestAsk = asks[0]?.x ?? 0;\nconst mid = (bestBid + bestAsk) / 2;\nif (bids.length > 0 && asks.length > 0) {\n  const bidY = bids[0].y;\n  const askY = asks[0].y;\n  const midY = Math.min(bidY, askY);\n  bids.unshift({ x: mid, y: midY });\n  asks.unshift({ x: mid, y: midY });\n  bids.push({ x: bids[bids.length - 1].x - 0.0001, y: 0 });\n  asks.push({ x: asks[asks.length - 1].x + 0.0001, y: 0 });\n}\n\n// --- SEGMENTED WALL LOGIC ---\nfunction segmentedWalls(levels, nSegments) {\n  const N = levels.length;\n  if (N === 0) return [];\n  const result = [];\n  const segSize = Math.floor(N / nSegments);\n\n  for (let seg = 0; seg < nSegments; seg++) {\n    const start = seg * segSize;\n    const end = seg === nSegments - 1 ? N : (seg + 1) * segSize;\n    let maxIdx = -1, maxRaw = -Infinity;\n    for (let i = start; i < end; i++) {\n      if (levels[i]?.raw !== undefined && levels[i].raw > maxRaw) {\n        maxRaw = levels[i].raw;\n        maxIdx = i;\n      }\n    }\n    if (maxIdx >= 0) result.push(levels[maxIdx]);\n  }\n  return result;\n}\n\nconst topBids = segmentedWalls(bids, NUM_SEGMENTS);\nconst topAsks = segmentedWalls(asks, NUM_SEGMENTS);\n\nconst wallLines = [...topBids, ...topAsks].map(wall => ({\n  type: \"line\",\n  x0: wall.x,\n  x1: wall.x,\n  y0: 0,\n  y1: 1,\n  xref: \"x\",\n  yref: \"paper\",\n  line: {\n    color: \"yellow\",\n    width: 1,\n    dash: \"dot\"\n  }\n}));\n\nconst wallLabels = [...topBids, ...topAsks].map(wall => ({\n  x: wall.x,\n  y: 1.02,\n  xref: \"x\",\n  yref: \"paper\",\n  text: wall.x.toFixed(5),\n  showarrow: false,\n  font: { color: \"yellow\", size: 10 }\n}));\n\nconst minX = Math.min(...bids.map(b => b.x), ...asks.map(a => a.x), mid);\nconst maxX = Math.max(...bids.map(b => b.x), ...asks.map(a => a.x), mid);\nconst pad = (maxX - minX) * 0.01; // 1% padding\n\nreturn {\n  data: [\n    {\n      name: \"Bids\",\n      x: bids.map(pt => pt.x),\n      y: bids.map(pt => pt.y),\n      mode: \"lines\",\n      fill: \"tozeroy\",\n      fillcolor: \"rgba(0,255,0,0.2)\",\n      line: { shape: \"hv\", color: \"rgba(0,255,0,0.7)\", width: 2 },\n      type: \"scatter\",\n      hovertemplate: \"Price: %{x}<br>CumVol: %{y}<extra></extra>\"\n    },\n    {\n      name: \"Asks\",\n      x: asks.map(pt => pt.x),\n      y: asks.map(pt => pt.y),\n      mode: \"lines\",\n      fill: \"tozeroy\",\n      fillcolor: \"rgba(255,0,0,0.2)\",\n      line: { shape: \"hv\", color: \"rgba(255,0,0,0.7)\", width: 2 },\n      type: \"scatter\",\n      hovertemplate: \"Price: %{x}<br>CumVol: %{y}<extra></extra>\"\n    }\n  ],\n  layout: {\n    plot_bgcolor: \"black\",\n    paper_bgcolor: \"black\",\n    font: { color: \"white\" },\n    xaxis: {\n      title: \"Price\",\n      type: \"linear\",\n      showgrid: true,\n      gridcolor: \"rgba(255,255,255,0.1)\",\n      zeroline: false,\n      range: [minX - pad, maxX + pad] // this forces the mid to be visible\n    },\n    yaxis: {\n      title: \"Cumulative Volume\",\n      type: \"log\",\n      showgrid: true,\n      gridcolor: \"rgba(255,255,255,0.1)\",\n      zeroline: false\n    },\n    margin: { t: 20, l: 40, r: 10, b: 30 },\n    shapes: [\n      {\n        type: \"line\",\n        x0: mid,\n        x1: mid,\n        y0: 0,\n        y1: 1,\n        xref: \"x\",\n        yref: \"paper\",\n        line: {\n          color: \"white\",\n          width: 1,\n          dash: \"dot\"\n        }\n      },\n      ...wallLines\n    ],\n    annotations: wallLabels,\n    legend: {\n      orientation: \"h\",\n      x: 0.5,\n      xanchor: \"center\",\n      y: -0.3\n    }\n  }\n};"
      },
      "pluginVersion": "0.5.0",
      "repeat": "SYMBOL",
      "repeatDirection": "h",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "format": 1,
          "queryType": "sql",
          "rawSql": "WITH snapshot AS (\n  SELECT timestamp, bids, asks\n  FROM eq_equities_market_data\n  WHERE $__timeFilter(timestamp) and  symbol = '${SYMBOL}' and venue in (${VENUE})\n  ORDER BY timestamp DESC\n  LIMIT 1\n)\nSELECT timestamp, bids[1] as bprices, bids[2] as bvolumes, array_cum_sum(bids[2]) as bcumvolumes,asks[1] as aprices, asks[2] as avolumes, array_cum_sum(asks[2]) as acumvolumes from snapshot;\n",
          "refId": "A",
          "selectedFormat": 2
        }
      ],
      "timeFrom": "15s",
      "timeShift": "5s",
      "title": "Market Depth - ${SYMBOL} - (${VENUE})",
      "type": "ae3e-plotly-panel"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 10
      },
      "id": 21,
      "panels": [],
      "repeat": "SYMBOL",
      "title": "Prices and Spread",
      "type": "row"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "description": "Rolling per-second spread and L1 notional volume across venues for the selected equity.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "fixedColor": "semi-dark-blue",
            "mode": "shades"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "color-background"
            },
            "inspect": false,
            "minWidth": 50
          },
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "#6ED0E0",
                "value": 11000000
              },
              {
                "color": "#EAB839",
                "value": 13000000
              },
              {
                "color": "red",
                "value": 14000000
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Time"
            },
            "properties": [
              {
                "id": "custom.minWidth",
                "value": 200
              },
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f894d",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Spread"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f8980",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Bid_Volume"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f89bf",
                  "mode": "fixed"
                }
              },
              {
                "id": "unit",
                "value": "short"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Ask_Volume"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "#692f89",
                  "mode": "fixed"
                }
              },
              {
                "id": "unit",
                "value": "short"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 10,
        "x": 0,
        "y": 11
      },
      "hideTimeOverride": true,
      "id": 20,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "enablePagination": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "editorMode": "code",
          "format": 1,
          "rawQuery": true,
          "rawSql": "SELECT\n  timestamp AS Time,\n  avg(asks[1,1] - bids[1,1]) AS Spread,\n  sum(bids[1,1] * bids[2,1]) AS Bid_Volume,\n  sum(asks[1,1] * asks[2,1]) AS Ask_Volume\nFROM eq_equities_market_data\nWHERE $__timeFilter(timestamp) AND symbol = '${SYMBOL}'\nSAMPLE BY 100T\nORDER BY timestamp DESC\nLIMIT 6;",
          "refId": "A",
          "selectedFormat": 2
        }
      ],
      "timeFrom": "10s",
      "title": "Spread and Volume per second - ${SYMBOL}",
      "transparent": true,
      "type": "table"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "description": "Per-5s OHLC from L2 best bid (arrays) for the chosen equity.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 3,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 13,
        "x": 11,
        "y": 11
      },
      "id": 28,
      "options": {
        "candleStyle": "candles",
        "colorStrategy": "open-close",
        "colors": {
          "down": "semi-dark-red",
          "up": "semi-dark-green"
        },
        "fields": {
          "close": "close",
          "high": "high",
          "low": "low",
          "open": "open",
          "volume": "total_volume"
        },
        "includeAllFields": false,
        "legend": {
          "calcs": [
            "last"
          ],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": false
        },
        "mode": "candles+volume",
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "editorMode": "code",
          "format": 1,
          "queryType": "sql",
          "rawQuery": true,
          "rawSql": "SELECT\n  timestamp,\n  first(bid_price) AS open,\n  max(bid_price)   AS high,\n  min(bid_price)   AS low,\n  last(bid_price)  AS close,\n  sum(bid_size)    AS total_volume\nFROM eq_top_of_book_1s\nWHERE $__timeFilter(timestamp)\n  AND symbol = '${SYMBOL}' \n  and venue in (${VENUE})\nSAMPLE BY 5s;",
          "refId": "A",
          "selectedFormat": 2
        }
      ],
      "timeFrom": "5m",
      "title": "OHLC - L2 Best Bid - 5s (${SYMBOL}) - (${VENUE})",
      "transparent": true,
      "type": "candlestick"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 19
      },
      "id": 23,
      "panels": [],
      "repeat": "SYMBOL",
      "title": "Indicators",
      "type": "row"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "description": "VWAP (from trades_ohlcv_1m), RSI on NBBO best bid (from nbbo_1s), and Bollinger Bands on 1m trade close.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineStyle": {
              "fill": "solid"
            },
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "RSI"
            },
            "properties": [
              {
                "id": "unit",
                "value": "RSI %"
              },
              {
                "id": "custom.axisPlacement",
                "value": "auto"
              },
              {
                "id": "custom.axisSoftMax",
                "value": 100
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 7,
        "w": 13,
        "x": 0,
        "y": 20
      },
      "hideTimeOverride": false,
      "id": 11,
      "options": {
        "candleStyle": "candles",
        "colorStrategy": "open-close",
        "colors": {
          "down": "light-blue",
          "up": "semi-dark-purple"
        },
        "fields": {
          "close": "close",
          "high": "high",
          "low": "low",
          "open": "open",
          "volume": "total_volume"
        },
        "includeAllFields": true,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "mode": "candles+volume",
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "expand": true,
          "format": 1,
          "queryType": "sql",
          "rawSql": "WITH sampled AS (\n    SELECT\n          timestamp,  symbol,\n          volume as total_volume,\n          ((open+close)/2) * volume AS traded_value\n     FROM eq_trades_ohlcv_1m\n     WHERE $__timeFilter(timestamp)\n      AND \n      symbol IN '${SYMBOL}'     \n), cumulative AS (\n     SELECT timestamp, symbol,\n           SUM(traded_value)\n                OVER (ORDER BY timestamp) AS cumulative_value,\n           SUM(total_volume)\n                OVER (ORDER BY timestamp) AS cumulative_volume\n     FROM sampled\n), vwap as (\nSELECT timestamp, cumulative_value/cumulative_volume AS vwap FROM cumulative\n)    \nSELECT * FROM vwap",
          "refId": "VWAP",
          "selectedFormat": 2
        },
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "format": 1,
          "queryType": "sql",
          "rawSql": "SELECT timestamp, first(open) as open, max(high) as high, last(close) as close, min(low) as low, sum(volume) as total_volume\nFROM eq_trades_ohlcv_1m\nWHERE $__timeFilter(timestamp) AND symbol = '${SYMBOL}'\nSAMPLE BY 15m",
          "refId": "OHLC",
          "selectedFormat": 2
        },
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "format": 1,
          "queryType": "sql",
          "rawSql": "WITH price_changes AS (\n       SELECT timestamp, symbol, bid, bid - prev_bid AS price_change FROM (\n       SELECT timestamp, symbol, max_bid AS bid,\n         LAG(max_bid) OVER (PARTITION BY symbol ORDER BY timestamp) AS prev_bid \n  FROM eq_nbbo_1h\n  WHERE $__timeFilter(timestamp) AND symbol = '${SYMBOL}'\n  )\n),\n gains_losses AS (\n  SELECT timestamp, symbol, bid,\n         CASE WHEN price_change > 0 THEN price_change ELSE 0 END AS gain,\n         CASE WHEN price_change < 0 THEN ABS(price_change) ELSE 0 END AS loss\n  FROM price_changes\n),\n avg_gains_losses AS (\n  SELECT timestamp, symbol, bid,\n         AVG(gain) OVER (PARTITION BY symbol ORDER BY timestamp ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS avg_gain,\n         AVG(loss) OVER (PARTITION BY symbol ORDER BY timestamp ROWS BETWEEN 11 PRECEDING AND CURRENT ROW) AS avg_loss\n  FROM gains_losses\n)\nSELECT timestamp,\n       CASE WHEN avg_loss = 0 THEN 100\n            ELSE 100 - (100 / (1 + (avg_gain / NULLIF(avg_loss, 0))))\n       END AS RSI_60s\nFROM avg_gains_losses\nORDER BY timestamp;",
          "refId": "RSI",
          "selectedFormat": 2
        },
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "format": 1,
          "queryType": "sql",
          "rawSql": "WITH stats AS (\n  SELECT timestamp, close,\n         AVG(close) OVER (ORDER BY timestamp ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS sma20,\n         AVG(close * close) OVER (ORDER BY timestamp ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS avg_close_sq  \n  FROM eq_trades_ohlcv_15m -- 20 periods of 15 minutes = SMA 6h\n  WHERE $__timeFilter(timestamp) AND symbol IN '${SYMBOL}' \n)\nSELECT timestamp, sma20,\n       sma20 + 2 * sqrt(avg_close_sq - (sma20 * sma20)) AS upper_band,\n       sma20 - 2 * sqrt(avg_close_sq - (sma20 * sma20)) AS lower_band\nFROM stats\nORDER BY timestamp",
          "refId": "Bollinger",
          "selectedFormat": 2
        }
      ],
      "timeFrom": "now/d",
      "title": "VWAP • RSI  12h• Bollinger Bands (20,2) (${SYMBOL})",
      "type": "candlestick"
    },
    {
      "datasource": {
        "type": "questdb-questdb-datasource",
        "uid": "${DS_QDB}"
      },
      "description": "Aggregated L1 notional bid/ask volume (30s) vs NBBO (1s).",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "barWidthFactor": 0.6,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "decimals": 4,
          "fieldMinMax": false,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "bid"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "semi-dark-purple",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "ask"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "light-blue",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "Volume"
            },
            "properties": [
              {
                "id": "unit",
                "value": "short"
              }
            ]
          },
          {
            "matcher": {
              "id": "byFrameRefID",
              "options": "BBO"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              },
              {
                "id": "color",
                "value": {
                  "mode": "palette-classic-by-name"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 7,
        "w": 11,
        "x": 13,
        "y": 20
      },
      "id": 26,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "multi",
          "sort": "none"
        }
      },
      "pluginVersion": "11.6.0",
      "targets": [
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "format": 1,
          "queryType": "sql",
          "rawSql": "SELECT\n  timestamp AS time,\n  symbol,\n  sum(bids[1,1] * bids[2,1])      AS bid,\n  -1 * sum(asks[1,1] * asks[2,1]) AS ask\nFROM eq_equities_market_data\nWHERE $__timeFilter(timestamp) AND symbol IN '${SYMBOL}' AND venue  IN (${VENUE})\nSAMPLE BY 30s;",
          "refId": "Volume",
          "selectedFormat": 2
        },
        {
          "datasource": {
            "type": "questdb-questdb-datasource",
            "uid": "${DS_QDB}"
          },
          "format": 1,
          "queryType": "sql",
          "rawSql": "SELECT\n  timestamp AS Time,\n  symbol,\n  bid_price AS Bid,\n  ask_price AS Ask,\n  (bid_price + ask_price) / 2 AS Mid\nFROM eq_top_of_book_1s\nWHERE $__timeFilter(timestamp)\n  AND symbol = '${SYMBOL}'\n  AND venue  IN (${VENUE})\n",
          "refId": "BBO",
          "selectedFormat": 2
        }
      ],
      "timeFrom": "30m",
      "title": "Bid vs Ask Volume (30s) • Top Of Book (5s) (${SYMBOL}) - (${VENUE})",
      "transparent": true,
      "type": "timeseries"
    }
  ],
  "refresh": "250ms",
  "schemaVersion": 41,
  "tags": [],
  "templating": {
    "list": [
      {
        "allowCustomValue": false,
        "current": {},
        "datasource": {
          "type": "questdb-questdb-datasource",
          "uid": "${DS_QDB}"
        },
        "definition": "SELECT DISTINCT symbol FROM (\n  SELECT symbol FROM eq_top_of_book_1s\n  WHERE timestamp > dateadd('d', -4, now())\n  LATEST ON timestamp PARTITION BY symbol\n) ORDER BY symbol;",
        "description": "symbol to filter by",
        "hide": 1,
        "includeAll": false,
        "label": "symbol",
        "multi": true,
        "name": "SYMBOL",
        "options": [],
        "query": "SELECT DISTINCT symbol FROM (\n  SELECT symbol FROM eq_top_of_book_1s\n  WHERE timestamp > dateadd('d', -4, now())\n  LATEST ON timestamp PARTITION BY symbol\n) ORDER BY symbol;",
        "refresh": 1,
        "regex": "",
        "type": "query"
      },
      {
        "allowCustomValue": false,
        "current": {},
        "definition": "SELECT DISTINCT venue FROM (\n  SELECT venue FROM eq_top_of_book_1s\n  WHERE timestamp > dateadd('d', -4, now())\n  LATEST ON timestamp PARTITION BY venue\n) ;",
        "description": "Venue",
        "includeAll": true,
        "label": "VENUE",
        "multi": true,
        "name": "VENUE",
        "options": [],
        "query": "SELECT DISTINCT venue FROM (\n  SELECT venue FROM eq_top_of_book_1s\n  WHERE timestamp > dateadd('d', -4, now())\n  LATEST ON timestamp PARTITION BY venue\n) ;",
        "refresh": 1,
        "regex": "",
        "sort": 1,
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "150ms",
      "250ms",
      "500ms",
      "750ms",
      "1s",
      "2s",
      "5s",
      "10s",
      "30s",
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ]
  },
  "timezone": "browser",
  "title": "Equities Orderbook - Realtime Demo",
  "uid": "equities-realtime",
  "version": 30,
  "weekStart": ""
}
